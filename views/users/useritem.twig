{% extends 'templates/default.twig' %}

{% block title %} Reporting App {% endblock %}

{% block script %}
{% if errors %}
<script type="text/javascript">
$('#create').modal('show');
</script>
{% endif %}
{% endblock %}

{% block headContent %}
<i style="color:green" class="fa fa-list-alt">  Item to Report  </i>
<span style="font-size: 20px;" class="pull-right" >
    {{ group }} group items
</span>
{% endblock %}

{% block content %}

<div class="row">
    <div class="col-xs-12">
        <div class="panel panel-default">
            <div class="panel-body">
                {% for item in items %}
                    {% endfor %}
                    <table id="" class="example2 table table-condensed table-bordered table-striped"
                    width="100%" cellspacing="0">
                    <thead>
                        <tr>
                            <th>Image</th>
                            <th>Name</th>
                            <th>Description</th>
                            <th class="text-center">Report it</th>
                            <th class="text-center">Delete</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in items %}
                        <tr>
                            <td class="text-center">
                                <img src="{{ base_url() }}/assets/images/{{ item.image }}"
                                     height="100" width="100" style="margin-bottom:5px">
                            </td>
                            <td>{{ item.name }}</td>
                            <td>{{ item.description }}</td>
                            <td class="text-center">
                                <a href="" data-toggle="modal" data-target="#{{item.id}}"
                                value="{{item.id}}"title="View Group Details"
                                style="margin-bottom:7px">
                                <button class="btn btn-info btn-md"
                                style="margin-right:10px">Report</button>
                            </a>
                        </td>
                        <td class="text-center">
                            {% if item.user_id != null %}
                            <a href="{{ path_for('user.item.delete', {('id'): item.id})}}"
                            title="Remove item" data-placement="top">
                            <button class="btn btn-danger btn-md"
                            style="margin-right:10px">Delete</button></a>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </form>
    </div>
</div>
</div>
</div>

<div class="row">
    <div class="col-xs-12" style="padding-bottom: 10px;">

        {% if reported == NULL %}

        <a href="{{ base_url() }}/user/group/{{ group_id }}/item?reported=1"
        class="btn-clear discard-answer dno">
        <button class="btn btn-primary" type="button">
            Show Reported Item <span class="badge">{{ count }}</span>
        </button></a>

        {% elseif reported == 1 %}
        <a href="{{ base_url() }}/user/group/{{ group_id }}/item" class="btn-clear discard-answer dno">
            <button class="btn btn-primary active" type="button">
                Hide Reported Item
            </button>
        </a>
        {% endif %}

        <a href="" data-toggle="modal" data-target="#create"
        title="View Group Details" style="margin-bottom:7px">
        <button class="btn btn-primary " type="button">
            <i class="fa fa-plus"></i> Create Item
        </button>
    </a>
</div>
</div>


{% if reported == 1 %}
<div class="" style="font-size:25px">
    <i style="color:green" class="fa fa-check-square-o"> Item Reported</i>
</div>
<div class="row">
    <div class="col-xs-12">
        <div class="panel panel-default">
            <div class="panel-body">
            </div>
            {% for item in itemdone %}
            <!-- <form action="{{ path_for('user.item.reset.status', {('id'): item.id })}}" method="get"> -->
                {% endfor %}
                <table id="" class="example2 table table-condensed table-bordered table-striped"
                width="100%" cellspacing="0">
                <thead>
                    <tr>
                        <th>Image</th>
                        <th>Name</th>
                        <th>Description</th>
                        <th class="text-center">Reported At</th>
                        <th class="text-center">Delete</th>

                    </tr>
                </thead>
                <tbody>
                    {% for item in itemdone %}
                    <tr>
                        <td class="text-center">
                            <img src="{{ base_url() }}/assets/images/{{ item.image }}"
                                 height="100" width="100" style="margin-bottom:5px">
                        </td>
                        <td>{{ item.name }}</td>
                        <td>{{ item.description }}</td>
                        <td class="text-center">
                            {{ item.reported_at }}
                        </a>
                        <!-- <input class="custom-control-input" id="checkbox"
                        type="checkbox"  onclick="this.form.submit();"> -->
                    </td>
                    <td class="text-center">
                        <a href="{{ path_for('user.item.delete', {('id'): item.id})}}"
                        title="Remove item" data-placement="top">
                        <button class="btn btn-danger btn-md"
                        style="margin-right:10px">Delete</button></a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </form>
</div>
</div>
</div>
{% endif %}


<!-- Modal -->
{% for item in items %}

<div id="{{ item.id}}" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="panel panel-default">
                <div class="panel panel-heading"><h3 class="panel-title">
                    <strong>Report item "{{ item.name }}"<u></strong></h3></div>
                        <div class="panel-body">
                            <form  action="{{path_for('user.item.report')}}"
                             method="POST" enctype="multipart/form-data">
                                {% if errors %}
                                <div class="alert alert-danger">
                                    <a class="close" data-dismiss="alert" href="#">x</a> Please fill out the form
                                </div>
                                {% endif %}

                                <div class="row" style="margin-left:45px;">
                                    <div class="col-xs-12 col-sm-6 col-md-10">
                                        <div class="form-group {{ errors.image ? 'has-error' : '' }}">
                                            <div id="image_preview" align="center"><img id="previewing"
                                                src="{{ base_url() }}/assets/images/{{ item.image }}"
                                                class="img-thumbnail" style="width:200px" >
                                            </div><br />
                                            <label>Image :</label>
                                            <div class="input-group">
                                                <div class="input-group-addon">
                                                    <i class="fa fa-image"></i>
                                                </div>
                                                <input type="file" id="file" class="form-control"
                                                name="image" placeholder="Item image">
                                            </div>
                                            {% if errors.image %}
                                            <span class="help-block">{{errors.image | first}}</span>
                                            {% endif %}<br />
                                        </div>
                                    </div>
                                </div>
                                <div class="row" style="margin-left:45px;">
                                    <div class="col-xs-12 col-sm-12 col-md-10">
                                        <div class="form-group {{ errors.description ? 'has-error' : '' }}">
                                            <label for="description">Description :</label>
                                            <textarea rows="5" name="description" class="form-control"
                                            value="{{ item.description }}"> {{ item.description }}
                                        </textarea>
                                        {% if errors.description %}
                                        <span class="help-block">{{ errors.description | first }}</span>
                                        {% endif %}
                                        <input type="hidden" name="item_id" value="{{ item.id }}">
                                        <input type="hidden" name="group_id" value="{{ group_id }}">
                                        <center>
                                            <br>
                                            {% if item.user_id != null %}
                                            <button  style="margin-top:30px;margin-bottom:10px;"
                                            type="submit" name="user" value="1" class="btn btn-info">
                                            <i class="fa fa-check-square-o" aria-hidden="true"></i> Report
                                            </button>
                                            {% else %}
                                            <button  style="margin-top:30px;margin-bottom:10px;"
                                            type="submit" name="group" value="2" class="btn btn-info">
                                            <i class="fa fa-check-square-o" aria-hidden="true"></i> Report
                                        </button>
                                        {% endif %}

                                    </center>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endfor %}


<div id="create" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="panel panel-default">
                <div class="panel panel-heading"><h3 class="panel-title">
                    <strong>Create my item in {{ group }}</strong></h3></div>
                    <div class="panel-body">
                        <form  action="{{path_for('user.item.create.post')}}"
                        method="POST" enctype="multipart/form-data">
                        {% if errors %}
                        <div class="alert alert-danger">
                            <a class="close" data-dismiss="alert" href="#">x</a> Please fill out the form
                        </div>
                        {% endif %}
                        <div class="row">
                            <div class="col-xs-12 col-sm-4 col-md-5">
                                <div class="form-group {{ errors.name ? 'has-error' : '' }}">
                                    <label for="name">Name :</label>
                                    <input type="text" name="name" class="form-control" value="{{ old.name }}">
                                    {% if errors.name %}
                                    <span class="help-block">{{ errors.name | first }}</span>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-xs-12 col-sm-6 col-md-7">
                                <div class="form-group {{ errors.description ? 'has-error' : '' }}">
                                    <label for="description">Description :</label>
                                    <input type="text" name="description" class="form-control"
                                    value="{{ old.description }}">
                                    {% if errors.description %}
                                    <span class="help-block">{{ errors.description | first }}</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-12 col-sm-5 col-md-5">
                                <div class="form-group {{ errors.recurrent ? 'has-error' : '' }}">
                                    <label for="recurrent">Recurring :</label>
                                    <select class="form-control" name="recurrent" value="">
                                        <option value="">No Recurring</option>
                                        <option value="daily" {% if  old.recurrent == "daily" %}
                                         selected="selected"{% endif %}>Daily</option>
                                        <option value="weekly" {% if  old.recurrent == "weekly" %}
                                         selected="selected"{% endif %}>Weekly</option>
                                        <option value="monthly" {% if  old.recurrent == "monthly" %}
                                         selected="selected"{% endif %}>Monthly</option>
                                        <option value="yearly" {% if  old.recurrent == "yearly" %}
                                         selected="selected"{% endif %}>Yearly</option>
                                    </select>
                                    {% if errors.recurrent %}
                                    <span class="help-block">{{ errors.recurrent | first }}</span>
                                    {% endif %}
                                </div>
                            </div>

                            <div class="col-xs-12 col-sm-6 col-md-7">
                                <div class="form-group {{ errors.start_date ? 'has-error' : '' }}">
                                    <label for="start_date">Start date :</label>
                                    <input type="date" name="start_date" class="form-control" value="{{ old.start_date }}">
                                    {% if errors.start_date %}
                                    <span class="help-block">{{ errors.start_date | first }}</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-12 col-sm-6 col-md-12">
                                <div class="form-group {{ errors.image ? 'has-error' : '' }}">
                                    <label>Image :</label>
                                    <div class="input-group">
                                        <div class="input-group-addon">
                                            <i class="fa fa-image"></i>
                                        </div>
                                        <input type="file" id="file" class="form-control"
                                        name="image" placeholder="Item image">
                                    </div>
                                    {% if errors.image %}
                                    <span class="help-block">{{errors.image | first}}</span>
                                    {% endif %}

                                    <input type="hidden" name="group_id" value="{{ group_id }}">
                                    <input type="hidden" name="user_id" value="{{ login.id }}">
                                    <center>
                                        <br>
                                        <button  style="margin-top:20px;margin-bottom:10px;"
                                        type="submit" class="btn btn-success">
                                        <i class="fa fa-check-square-o" aria-hidden="true"></i> Create
                                    </button>
                                </center>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
